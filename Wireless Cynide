//Wireless Cynide (Webserver edition)

#include <ESP8266WiFi.h>
#include <ESP8266WebServer.h>

const char* ssid = "Cyanide";
const char* pass = "12345678";

ESP8266WebServer server(80);

#define IN1 5   //D1
#define IN2 4   //D2
#define IN3 0   //D3
#define IN4 2   //D4
#define ENA 14    //D5
#define ENB 12    //D6

void setup() {
  pinMode(IN1, OUTPUT); pinMode(IN2, OUTPUT); 
  pinMode(IN3, OUTPUT); pinMode(IN4, OUTPUT);
  pinMode(ENA, OUTPUT); pinMode(ENB, OUTPUT);

  WiFi.softAP(ssid, pass);
  server.on("/", [](){ server.send(200, "text/html", 
    "<html><head><meta name='viewport' contents='width=device-width, initial-scale=1'></head>"
    "<body style='text-align:center;font-family:Arial'>"
    "<h1>CYANIDE WIRELESS CONTROL</h1>"
    "<a href='/f'><button style='sont-size:50px;padding:30px;margin:10px;width:80%'>FORWARD</button></a><br>"
    "<a href='/b'><button style='sont-size:50px;padding:30px;margin:10px;width:80%'>BACKWARD</button></a><br>"
    "<a href='/l'><button style='sont-size:50px;padding:30px;margin:10px;width:80%'>LEFT</button></a>"
    "<a href='/r'><button style='sont-size:50px;padding:30px;margin:10px;width:80%'>RIGHT</button></a><br>"
    "<a href='/s'><button style='sont-size:50px;padding:30px;margin:10px;width:80%;background:red;color:white'>STOP</button></a><br><br>"
    "<p>Speed: <a href='/f?255>MAX</a> | <a href='/f?180'>MED</a> | <a href='/f?100'>SLOW</a></p>"
    "</body></html>");
  });

  server.on("/f", [](){ moveBot(1, 1, server.hasArg("255") ? 255 : server.hasArg("180") ? 180 : 100); server.send(200, "text/plain", "Forward"); });
  server.on("/b", [](){ moveBot(0,0,180); server.send(200, "text/plain", "Backward"); });
  server.on("/l", [](){ moveBot(0,1,180); server.send(200, "text/plain", "Left"); });
  server.on("/r", [](){ moveBot(1,0,180); server.send(200, "text/plain", "Right"); });
  server.on("/s", [](){ moveBot(0,0,0); server.send(200, "text/plain", "Stopped"); });

  server.begin();
  Serial.begin(115200);
  Serial.println("/nWiFi AP started - connect to 'Cyanide'");
}

void loop() { server.handleClient(); }

void moveBot(bool dirLeft, bool dirRight, int speed) {
  analogWrite(ENA, speed); analogWrite(ENB, speed);
  digitalWrite(IN1, dirLeft); digitalWrite(IN2, !dirLeft);
  digitalWrite(IN3, dirRight); digitalWrite(IN4, !dirRight);
}
